{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "devup-config-schema",
  "title": "Devup Configuration Schema",
  "description": "Schema for devup configuration files supporting both legacy single-package and chain multi-package configurations",
  "type": "object",
  "required": ["configs"],
  "properties": {
    "configs": {
      "type": "array",
      "minItems": 1,
      "items": {
        "oneOf": [
          {
            "$ref": "#/$defs/LegacyConfig"
          },
          {
            "$ref": "#/$defs/ChainConfig"
          }
        ]
      }
    }
  },
  "$defs": {
    "LegacyConfig": {
      "type": "object",
      "title": "Legacy Single Package Configuration",
      "required": ["name", "description", "package_dir", "app_dir", "package_name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Configuration name used with devup -name"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this configuration"
        },
        "package_dir": {
          "type": "string",
          "description": "Path to the package directory (supports $HOME and environment variables)"
        },
        "app_dir": {
          "type": "string",
          "description": "Path to the application directory (supports $HOME and environment variables)"
        },
        "package_name": {
          "type": "string",
          "description": "NPM package name (e.g., @myorg/my-package)"
        },
        "start_command": {
          "type": "string",
          "default": "./pnpm start",
          "description": "Command to start the development server"
        },
        "build_command": {
          "type": "string",
          "default": "./pnpm run build",
          "description": "Command to build the package"
        },
        "type": {
          "type": "string",
          "enum": ["legacy"],
          "description": "Configuration type (optional for legacy configs)"
        }
      },
      "additionalProperties": false
    },
    "ChainConfig": {
      "type": "object",
      "title": "Chain Multi-Package Configuration",
      "required": ["name", "description", "type", "chain"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Configuration name used with devup -name"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this configuration"
        },
        "type": {
          "type": "string",
          "enum": ["chain"],
          "description": "Configuration type must be 'chain'"
        },
        "chain": {
          "type": "array",
          "minItems": 1,
          "description": "Array of packages and apps in dependency order",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/PackageNode"
              },
              {
                "$ref": "#/$defs/AppNode"
              }
            ]
          }
        }
      },
      "additionalProperties": false
    },
    "PackageNode": {
      "type": "object",
      "title": "Package Node",
      "required": ["type", "name", "package_dir", "package_name"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["package"],
          "description": "Node type must be 'package'"
        },
        "name": {
          "type": "string",
          "description": "Unique name for this node within the chain"
        },
        "package_dir": {
          "type": "string",
          "description": "Path to the package directory (supports $HOME and environment variables)"
        },
        "package_name": {
          "type": "string",
          "description": "NPM package name (e.g., @myorg/my-package)"
        },
        "build_command": {
          "type": "string",
          "default": "./pnpm run build",
          "description": "Command to build this package"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of node names this package depends on"
        }
      },
      "additionalProperties": false
    },
    "AppNode": {
      "type": "object",
      "title": "App Node",
      "required": ["type", "name", "app_dir"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["app"],
          "description": "Node type must be 'app'"
        },
        "name": {
          "type": "string",
          "description": "Unique name for this node within the chain"
        },
        "app_dir": {
          "type": "string",
          "description": "Path to the application directory (supports $HOME and environment variables)"
        },
        "start_command": {
          "type": "string",
          "default": "./pnpm start",
          "description": "Command to start the development server"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of node names this app depends on"
        }
      },
      "additionalProperties": false
    }
  }
}